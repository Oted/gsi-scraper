{
	"extractor": "dom_object",
	"keys": {
		"name": {
			"extractor": "dom_path",
			"path": "div.title span.product_title"
		},
		"description": [ {
			"extractor": "dom_array",
			"path": "div.product-description ul li ul li",
			"flatten": true,
			"join": ". "
		},{
			"extractor": "dom_path",
			"path": "div.product-description",
			"replace": {
				"find": "-\\t",
				"replace": " "
			}
		} ],
		"images": {
			"extractor": "dom_array",
			"path": "div.productImagesItems img.xl",
			"type": "string",
			"replace": {
				"find": "xl.jpg",
				"replace": "xxl.jpg"
			},
			"attr": "src"
		},
		"pid": {
			"extractor": "dom_path",
			"path": "input#CatwalkInventoryId",
			"attr": "value"
		},
		"currency": {
			"extractor": "dom_path",
			"path": "div#localisationMenu option[selected=selected]",
			"replace": {
				"find": "\\W",
				"replace": ""
			}
		},
		"price.original": {
			"extractor": "dom_path",
			"path": "div.product_price span.product_price_details",
			"type": "number"
		},
		"price.sale": {
			"extractor": "dom_path",
			"path": "div.product_price span.previousprice",
			"type": "number"
		},
		"related": {
			"extractor": "dom_array",
			"path": "div.complete-the-look div.item",
			"type": "object",
			"mapping": {
				"extractor": "dom_object",
				"keys": {
					"images": {
						"extractor": "dom_path",
						"path": "a.item-link img",
						"attr": "data-href"
					},
					"name": {
						"extractor": "dom_path",
						"path": "a.item-link img",
						"attr": "alt"
					},
					"url": {
						"extractor": "dom_path",
						"path": "a.item-link",
						"attr": "href",
						"prefix": "http://www.asos.com"
					}
				}
			}
		},
		"stock": {
			"extractor": "json_endpoint",
			"url": "http://www.asos.com/services/quickview/srvquickview.asmx/DataForInventoryItem",
			"method": "POST",
			"data": "{\"inventoryId\": {{pid}} }",
			"mapping": {
				"path": "d.SizeColours",
				"type": "array",
				"mapping": {
					"type": "object",
					"keys": {
						"_id": {
							"type": "string",
							"path": "Text"
						},
						"colour": {
							"type": "string",
							"path": "Text"
						},
						"price": {
							"type": "number",
							"path": "Price"
						},
						"sizes": {
							"type": "array",
							"path": "Sizes",
							"mapping": {
								"type": "object",
								"keys": {
									"_id": {
										"type": "string",
										"path": "Text"
									},
									"size": {
										"type": "string",
										"path": "Text"
									},
                                    "price.original" : {
                                        "type" : "reference",
                                        "path" : "price.orginal"
                                    },
									"size_id": {
										"type": "string",
										"path": "Value"
									},
									"stock_level": {
										"type": "conditional",
										"conditions": [
											{
												"operator": "and",
												"conditions": {
													"IsAvailable" : true,
													"ShowLowInStock": false
												},
												"result": "in"
											},
											{
												"operator": "and",
												"conditions": {
													"IsAvailable" : true,
													"ShowLowInStock": true
												},
												"result": "low"
											},
											{
												"operator": "and",
												"conditions": {
													"IsAvailable" : false
												},
												"result": "out"
											}
										],
										"default": "notavailable"
									}
								}
							}
						}
					}
				}
			}
		}
	}
}
